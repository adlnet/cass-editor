(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30de3948"],{"9fc7":function(e,t,i){"use strict";var s=i("b099"),n=i.n(s);n.a},b099:function(e,t,i){},ede4:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"section is-large",attrs:{id:"login"}},[i("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[i("div",{staticClass:"modal-background"}),e._m(0)]),e.loginBusy?e._e():i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e.loginBusy?e._e():i("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[e.amJustLoggingIn?i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Login to CaSS Authoring Tool ")]):e._e(),e.amCreatingAccount?i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Create CaSS Authoring Tool User ")]):e._e(),e.amCreatingLinkedPerson?i("h4",{staticClass:"title is-size-2 has-text-centered has-text-white"},[e._v(" Link User Information ")]):e._e()]),i("section",{staticClass:"modal-card-body"},[e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"section"},[e.amCreatingLinkedPerson?i("p",[e._v(" No matching user record could be found that matched your login information. Please provide the following: ")]):e._e()]):e._e(),e.amJustLoggingIn?i("div",{staticClass:"section"},[i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("Username")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"input is-small",attrs:{type:"text",placeholder:"username"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})])]),i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("Password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input is-small",attrs:{type:"password",placeholder:"password"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.attemptCassLogin(t)},input:function(t){t.target.composing||(e.password=t.target.value)}}})])])]):e._e(),i("div",{staticClass:"section"},[e.amCreatingAccount?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("username")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountUsername,expression:"createAccountUsername"}],staticClass:"input is-small",attrs:{type:"text"},domProps:{value:e.createAccountUsername},on:{input:function(t){t.target.composing||(e.createAccountUsername=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonName,expression:"createLinkPersonName"}],staticClass:"input is-small ",attrs:{type:"text "},domProps:{value:e.createLinkPersonName},on:{input:function(t){t.target.composing||(e.createLinkPersonName=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("email")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonEmail,expression:"createLinkPersonEmail"}],staticClass:"input is-small ",attrs:{type:"text "},domProps:{value:e.createLinkPersonEmail},on:{input:function(t){t.target.composing||(e.createLinkPersonEmail=t.target.value)}}})])]):e._e(),e.amCreatingAccount?i("div",{staticClass:"field is-grouped"},[i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPassword,expression:"createAccountPassword"}],staticClass:"input is-small ",attrs:{type:"password"},domProps:{value:e.createAccountPassword},on:{input:function(t){t.target.composing||(e.createAccountPassword=t.target.value)}}})]),i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("Confirm password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPasswordRetype,expression:"createAccountPasswordRetype"}],staticClass:"input is-small ",attrs:{type:"password"},domProps:{value:e.createAccountPasswordRetype},on:{input:function(t){t.target.composing||(e.createAccountPasswordRetype=t.target.value)}}})])]):e._e()]),e.createAccountOrLinkPersonDataInvalid?i("div",{staticClass:"field has-text-danger"},[i("div",{staticClass:"label has-text-danger"},[e._v(" Please correct the following errors: ")]),e.createAccountUsernameInvalid?i("div",{staticClass:"is-size-7"},[e._v(" Username is required ")]):e._e(),e.createAccountPasswordInvalid?i("div",{staticClass:"is-size-7"},[e._v(" Password is required ")]):e._e(),e.createAccountPasswordMismatch?i("div",{staticClass:"is-size-7"},[e._v(" Passwords do not match ")]):e._e(),e.createLinkPersonNameInvalid?i("div",{staticClass:"is-size-7"},[e._v(" Name is required ")]):e._e(),e.createLinkPersonEmailInvalid?i("div",{staticClass:"is-size-7"},[e._v(" Valid email is required ")]):e._e(),e.createLinkPersonEmailExists?i("div",{staticClass:"is-size-7"},[e._v(" That email is already in use ")]):e._e()]):e._e(),e.identityFetchFailed||e.configRetrieveFailed||e.loginParamsInvalid?i("div",{staticClass:"section"},[e.identityFetchFailed?i("div",[i("p",[i("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?i("div",[i("p",[i("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e(),e.loginParamsInvalid?i("div",[e._m(1)]):e._e()]):e._e(),e.identityFetchFailed?i("div",{staticClass:"field"},[i("p",[i("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?i("div",{staticClass:"field"},[i("p",[i("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e()]),i("footer",{staticClass:"modal-card-foot has-background-white"},[i("div",{staticClass:"buttons is-spaced"},[e.amCreatingLinkedPerson||e.amCreatingAccount?i("div",{staticClass:"button is-dark is-outlined",on:{click:function(t){return e.setDataToBaseLogin(!0)}}},[e._m(2),i("span",[e._v("cancel")])]):e._e(),e.amJustLoggingIn?[i("div",{staticClass:"button is-outlined is-dark",on:{click:e.showCreateAccount}},[e._m(3),i("span",[e._v("create account")])]),i("div",{staticClass:"button is-outlined is-primary",on:{click:e.attemptCassLogin}},[e._m(4),i("span",[e._v("login")])])]:e._e(),e.amCreatingAccount?i("div",{staticClass:"button is-expanded is-primary is-outlined",on:{click:e.createNewAccount}},[e._m(5),i("span",[e._v("create")])]):e._e(),e.amCreatingLinkedPerson?i("div",{staticClass:"button is-success is-outlined",on:{click:e.linkPerson}},[e._m(6),i("span",[e._v("update")])]):e._e()],2)])])])])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal-content has-text-centered"},[i("span",{staticClass:"icon is-large has-text-center has-text-link"},[i("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[i("b",[e._v("Login failed: Invalid Username/Password")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])}],a=(i("b0c0"),i("ac1f"),i("841c"),i("498a"),i("b85c")),o={name:"Login",data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,GROUP_PPK_KEY:"https://schema.cassproject.org/0.3/ppk",username:"",password:"",createAccountUsername:"",createAccountPassword:"",createAccountPasswordRetype:"",createLinkPersonName:"",createLinkPersonEmail:"",loginParamsInvalid:!1,identityFetchFailed:!1,configRetrieveFailed:!1,loginBusy:!1,ecRemoteIdentMgr:{},configFailMsg:"",identityFailMsg:"",amJustLoggingIn:!0,amCreatingAccount:!1,amCreatingLinkedPerson:!1,createAccountOrLinkPersonDataInvalid:!1,createAccountUsernameInvalid:!1,createAccountPasswordInvalid:!1,createAccountPasswordMismatch:!1,createLinkPersonNameInvalid:!1,createLinkPersonEmailInvalid:!1,createLinkPersonEmailExists:!1,identityToLinkToPerson:{},linkedPerson:{}}},methods:{goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},addGroupIdentity:function(e){console.log("Adding group identity: ("+e.shortId()+") - "+e.getName());var t=new EcEncryptedValue;t.copyFrom(e[this.GROUP_PPK_KEY]);var i=t.decryptIntoString(),s=new EcIdentity;s.displayName=e.getName(),s.ppk=EcPpk.fromPem(i),EcIdentityManager.addIdentityQuietly(s)},searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var i,s=Object(a["a"])(e);try{for(s.s();!(i=s.n()).done;){var n=i.value;if(n.employee&&n.employee.length>0){var o,r=Object(a["a"])(n.employee);try{for(r.s();!(o=r.n()).done;){var c=o.value;if(c.equals(t)){this.addGroupIdentity(n);break}}}catch(l){r.e(l)}finally{r.f()}}}}catch(l){s.e(l)}finally{s.f()}}},searchRepositoryForGroupsFailure:function(e){console.log("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){console.log(" Adding group identities...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e),this.goToAppHome()},setDataToBaseLogin:function(e){this.username="",this.password="",this.createAccountUsername="",this.createAccountPassword="",this.createAccountPasswordRetype="",this.createLinkPersonName="",this.createLinkPersonEmail="",this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.configFailMsg="",this.identityFailMsg="",this.amCreatingAccount=!1,this.amCreatingLinkedPerson=!1,this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,e&&(this.ecRemoteIdentMgr={},EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.identityToLinkToPerson={},this.linkedPerson={}),this.amJustLoggingIn=!0,this.loginBusy=!1},showCreateAccount:function(){this.setDataToBaseLogin(!0),this.amJustLoggingIn=!1,this.amCreatingAccount=!0},showCreateLinkedPerson:function(){this.setDataToBaseLogin(!1),this.amJustLoggingIn=!1,this.amCreatingLinkedPerson=!0},setAllNewAccountValidationsChecksToValid:function(){this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.createAccountUsername&&!this.createAccountUsername.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameInvalid=!0),!this.createAccountPassword||this.createAccountPassword.trim().equals("")||!this.createAccountPasswordRetype||this.createAccountPasswordRetype.trim().equals("")?(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordInvalid=!0):this.createAccountPassword.equals(this.createAccountPasswordRetype)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordMismatch=!0),this.validateLinkPersonData()},handleCreatePersonSuccess:function(){console.log("Person created."),this.amCreatingAccount?this.goToAppHome():this.addGroupIdentities()},createPersonObjectToLinkToIdentity:function(){console.log("Creating person object for identity...");var e=new Person;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.createLinkPersonName,e.email=this.createLinkPersonEmail,console.log(e),this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountFetchIdentitySuccess:function(){console.log("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.createLinkPersonName,e.ppk=EcPpk.generateKey(),EcIdentityManager.addIdentity(e),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectToLinkToIdentity,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){console.log("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountConfigureFromServerSuccess:function(e){console.log("EcRemoteIdentityManager creating..."),console.log("Creating new account login..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailure)},createNewAccountIdentityAndPerson:function(){console.log("Creating new account..."),console.log("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){console.log("New account person search success: "),console.log(e);var t,i=!1,s=Object(a["a"])(e);try{for(s.s();!(t=s.n()).done;){var n=t.value,o=new EcPerson;if(o.copyFrom(n),this.createLinkPersonEmail.equalsIgnoreCase(o.email)){i=!0;break}}}catch(r){s.e(r)}finally{s.f()}i?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createNewAccountIdentityAndPerson()},searchPersonsForNewAccountFailure:function(e){this.loginBusy=!1,console.log("New account person search failure: "+e)},verifyEmailAddressForNewAccountAndGo:function(){this.loginBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},createNewAccount:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForNewAccountAndGo()},validateLinkPersonData:function(){this.createLinkPersonName&&!this.createLinkPersonName.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonNameInvalid=!0),this.createLinkPersonEmail&&!this.createLinkPersonEmail.trim().equals("")&&this.isValidEmail(this.createLinkPersonEmail)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailInvalid=!0)},searchPersonsForLinkPersonSuccess:function(e){this.loginBusy=!0;var t,i=!1,s=Object(a["a"])(e);try{for(s.s();!(t=s.n()).done;){var n=t.value,o=new EcPerson;if(o.copyFrom(n),this.createLinkPersonEmail.equalsIgnoreCase(o.email)){i=!0;break}}}catch(r){s.e(r)}finally{s.f()}i?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createPersonObjectToLinkToIdentity()},verifyEmailAddressForLinkPersonAndGo:function(){console.log("Validating link person email...");var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForLinkPersonSuccess,this.searchPersonsForNewAccountFailure)},linkPerson:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateLinkPersonData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForLinkPersonAndGo()},areLoginParamsValid:function(){return null!=this.username&&0!==this.username.length&&null!=this.password&&0!==this.password.length||(this.loginParamsInvalid=!0,!1)},findLinkedPersonPersonSearchSuccess:function(e){console.log("Linked person person search success: "),console.log(e),this.identityToLinkToPerson=EcIdentityManager.ids[0];var t,i=!1,s=Object(a["a"])(e);try{for(s.s();!(t=s.n()).done;){var n=t.value,o=new EcPerson;o.copyFrom(n),o.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(i=!0,this.$store.commit("user/loggedOnPerson",o),this.linkedPerson=o,console.log("Matching person record found: "),console.log(o))}}catch(r){s.e(r)}finally{s.f()}i?this.addGroupIdentities():(console.log("Matching person record NOT found"),this.showCreateLinkedPerson())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,console.log("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){console.log("Finding linked person for identity...");var e=EcIdentityManager.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.ids||EcIdentityManager.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginConfigureFromServerSuccess:function(e){console.log("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.username,this.password),this.ecRemoteIdentMgr.fetch(this.handleAttemptLoginFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},attemptCassLogin:function(){this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.areLoginParamsValid()&&(console.log("Attempting CaSS login...."),this.loginBusy=!0,EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail))}},mounted:function(){this.setDataToBaseLogin(!0)}},r=o,c=(i("9fc7"),i("2877")),l=Object(c["a"])(r,s,n,!1,null,"2219c6d9",null);t["default"]=l.exports}}]);
//# sourceMappingURL=chunk-30de3948.09c5e6ad.js.map