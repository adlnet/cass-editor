(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b36c218"],{"201e":function(e,t,n){},"364f":function(e,t,n){"use strict";var i=n("201e"),s=n.n(i);s.a},ede4:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container is-fluid is-marginless is-paddingless has-background-white",attrs:{id:"login"}},[n("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[n("div",{staticClass:"modal-background"}),e._m(0)]),n("div",{staticClass:"columns is-vcentered is-centered"},[n("div",{staticClass:"column is-4"},[e.loginBusy?e._e():n("div",{staticClass:"card"},[e.amJustLoggingIn?n("header",{staticClass:"card-header has-background-primary"},[n("h3",{staticClass:"card-header-title has-text-white"},[e._v("\n                        CAT Login\n                    ")])]):e._e(),e.amCreatingAccount?n("header",{staticClass:"card-header has-background-primary"},[n("h3",{staticClass:"card-header-title has-text-white"},[e._v("\n                        CAT Signup\n                    ")])]):e._e(),e.amJustLoggingIn?n("div",{staticClass:"card-content"},[n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("Username")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"input",attrs:{type:"text",placeholder:"username"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})])]),n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("Password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"password"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.attemptCassLogin(t)},input:function(t){t.target.composing||(e.password=t.target.value)}}})])]),e.identityFetchFailed?n("div",[n("p",[n("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?n("div",[n("p",[n("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e(),e.loginParamsInvalid?n("div",[e._m(1)]):e._e(),n("div",{staticClass:"buttons"},[n("div",{staticClass:"button is-light",on:{click:e.showCreateAccount}},[e._v("\n                            create account\n                        ")]),n("div",{staticClass:"button is-primary",on:{click:e.attemptCassLogin}},[e._v("\n                            login\n                        ")])])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?n("div",{staticClass:"card-content"},[e.amCreatingLinkedPerson?n("h4",[e._v("\n                        Link User Information\n                    ")]):e._e(),e.amCreatingLinkedPerson?n("p",[e._v("\n                        No matching user record could be found that matched your login information. Please provide the following:\n                    ")]):e._e(),e.amCreatingAccount?n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("username")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountUsername,expression:"createAccountUsername"}],staticClass:"input",attrs:{type:"text",placeholder:"username"},domProps:{value:e.createAccountUsername},on:{input:function(t){t.target.composing||(e.createAccountUsername=t.target.value)}}})])]):e._e(),e.amCreatingAccount?n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPassword,expression:"createAccountPassword"}],staticClass:"input",attrs:{type:"password",placeholder:"password"},domProps:{value:e.createAccountPassword},on:{input:function(t){t.target.composing||(e.createAccountPassword=t.target.value)}}})])]):e._e(),e.amCreatingAccount?n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPasswordRetype,expression:"createAccountPasswordRetype"}],staticClass:"input",attrs:{type:"password",placeholder:"retype password"},domProps:{value:e.createAccountPasswordRetype},on:{input:function(t){t.target.composing||(e.createAccountPasswordRetype=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("name")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonName,expression:"createLinkPersonName"}],staticClass:"input",attrs:{type:"text",placeholder:"name"},domProps:{value:e.createLinkPersonName},on:{input:function(t){t.target.composing||(e.createLinkPersonName=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?n("div",{staticClass:"field"},[n("div",{staticClass:"control"},[n("label",{staticClass:"label"},[e._v("email")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonEmail,expression:"createLinkPersonEmail"}],staticClass:"input",attrs:{type:"text",placeholder:"email"},domProps:{value:e.createLinkPersonEmail},on:{input:function(t){t.target.composing||(e.createLinkPersonEmail=t.target.value)}}})])]):e._e(),e.createAccountOrLinkPersonDataInvalid?n("div",{staticClass:"field has-text-danger"},[n("div",{staticClass:"label has-text-danger"},[e._v("\n                            Please correct the following errors:\n                        ")]),e.createAccountUsernameInvalid?n("div",{staticClass:"is-size-7"},[e._v("\n                            Username is required\n                        ")]):e._e(),e.createAccountPasswordInvalid?n("div",{staticClass:"is-size-7"},[e._v("\n                            Password is required\n                        ")]):e._e(),e.createAccountPasswordMismatch?n("div",{staticClass:"is-size-7"},[e._v("\n                            Passwords do not match\n                        ")]):e._e(),e.createLinkPersonNameInvalid?n("div",{staticClass:"is-size-7"},[e._v("\n                            Name is required\n                        ")]):e._e(),e.createLinkPersonEmailInvalid?n("div",{staticClass:"is-size-7"},[e._v("\n                            Valid email is required\n                        ")]):e._e(),e.createLinkPersonEmailExists?n("div",{staticClass:"is-size-7"},[e._v("\n                            That email is already in use\n                        ")]):e._e()]):e._e(),e.identityFetchFailed?n("div",{staticClass:"field"},[n("p",[n("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?n("div",{staticClass:"field"},[n("p",[n("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e(),n("div",{staticClass:"field"},[n("div",{staticClass:"buttons"},[e.amCreatingLinkedPerson||e.amCreatingAccount?n("div",{staticClass:"button is-light",on:{click:function(t){return e.setDataToBaseLogin(!0)}}},[e._v("\n                                cancel\n                            ")]):e._e(),e.amCreatingAccount?n("div",{staticClass:"button is-primary",on:{click:e.createNewAccount}},[e._v("\n                                create\n                            ")]):e._e(),e.amCreatingLinkedPerson?n("div",{staticClass:"button is-success",on:{click:e.linkPerson}},[e._v("\n                                update\n                            ")]):e._e()])])]):e._e()])])])])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal-content has-text-centered"},[n("span",{staticClass:"icon is-large has-text-center has-text-link"},[n("i",{staticClass:"fas fa-3x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[n("b",[e._v("Login failed: Invalid Username/Password")])])}],a=(n("386d"),n("ac4d"),n("8a81"),n("ac6a"),{name:"Login",data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,GROUP_PPK_KEY:"https://schema.cassproject.org/0.3/ppk",username:"",password:"",createAccountUsername:"",createAccountPassword:"",createAccountPasswordRetype:"",createLinkPersonName:"",createLinkPersonEmail:"",loginParamsInvalid:!1,identityFetchFailed:!1,configRetrieveFailed:!1,loginBusy:!1,ecRemoteIdentMgr:{},configFailMsg:"",identityFailMsg:"",amJustLoggingIn:!0,amCreatingAccount:!1,amCreatingLinkedPerson:!1,createAccountOrLinkPersonDataInvalid:!1,createAccountUsernameInvalid:!1,createAccountPasswordInvalid:!1,createAccountPasswordMismatch:!1,createLinkPersonNameInvalid:!1,createLinkPersonEmailInvalid:!1,createLinkPersonEmailExists:!1,identityToLinkToPerson:{},linkedPerson:{}}},methods:{goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},addGroupIdentity:function(e){console.log("Adding group identity: ("+e.shortId()+") - "+e.getName());var t=new EcEncryptedValue;t.copyFrom(e[this.GROUP_PPK_KEY]);var n=t.decryptIntoString(),i=new EcIdentity;i.displayName=e.getName(),i.ppk=EcPpk.fromPem(n),EcIdentityManager.addIdentityQuietly(i)},searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var n=!0,i=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var o=a.value;if(o.employee&&o.employee.length>0){var c=!0,l=!1,d=void 0;try{for(var u,h=o.employee[Symbol.iterator]();!(c=(u=h.next()).done);c=!0){var m=u.value;if(m.equals(t)){this.addGroupIdentity(o);break}}}catch(g){l=!0,d=g}finally{try{c||null==h.return||h.return()}finally{if(l)throw d}}}}}catch(g){i=!0,s=g}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}}},searchRepositoryForGroupsFailure:function(e){console.log("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){console.log(" Adding group identities...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e),this.goToAppHome()},setDataToBaseLogin:function(e){this.username="",this.password="",this.createAccountUsername="",this.createAccountPassword="",this.createAccountPasswordRetype="",this.createLinkPersonName="",this.createLinkPersonEmail="",this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.configFailMsg="",this.identityFailMsg="",this.amCreatingAccount=!1,this.amCreatingLinkedPerson=!1,this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,e&&(this.ecRemoteIdentMgr={},EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.identityToLinkToPerson={},this.linkedPerson={}),this.amJustLoggingIn=!0,this.loginBusy=!1},showCreateAccount:function(){this.setDataToBaseLogin(!0),this.amJustLoggingIn=!1,this.amCreatingAccount=!0},showCreateLinkedPerson:function(){this.setDataToBaseLogin(!1),this.amJustLoggingIn=!1,this.amCreatingLinkedPerson=!0},setAllNewAccountValidationsChecksToValid:function(){this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.createAccountUsername&&!this.createAccountUsername.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameInvalid=!0),!this.createAccountPassword||this.createAccountPassword.trim().equals("")||!this.createAccountPasswordRetype||this.createAccountPasswordRetype.trim().equals("")?(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordInvalid=!0):this.createAccountPassword.equals(this.createAccountPasswordRetype)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordMismatch=!0),this.validateLinkPersonData()},handleCreatePersonSuccess:function(){console.log("Person created."),this.amCreatingAccount?this.goToAppHome():this.addGroupIdentities()},createPersonObjectToLinkToIdentity:function(){console.log("Creating person object for identity...");var e=new Person;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.createLinkPersonName,e.email=this.createLinkPersonEmail,console.log(e),this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountFetchIdentitySuccess:function(){console.log("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.createLinkPersonName,e.ppk=EcPpk.generateKey(),EcIdentityManager.addIdentity(e),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectToLinkToIdentity,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){console.log("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountConfigureFromServerSuccess:function(e){console.log("EcRemoteIdentityManager creating..."),console.log("Creating new account login..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailure)},createNewAccountIdentityAndPerson:function(){console.log("Creating new account..."),console.log("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){console.log("New account person search success: "),console.log(e);var t=!1,n=!0,i=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var o=a.value,c=new EcPerson;if(c.copyFrom(o),this.createLinkPersonEmail.equalsIgnoreCase(c.email)){t=!0;break}}}catch(l){i=!0,s=l}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}t?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createNewAccountIdentityAndPerson()},searchPersonsForNewAccountFailure:function(e){this.loginBusy=!1,console.log("New account person search failure: "+e)},verifyEmailAddressForNewAccountAndGo:function(){this.loginBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},createNewAccount:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForNewAccountAndGo()},validateLinkPersonData:function(){this.createLinkPersonName&&!this.createLinkPersonName.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonNameInvalid=!0),this.createLinkPersonEmail&&!this.createLinkPersonEmail.trim().equals("")&&this.isValidEmail(this.createLinkPersonEmail)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailInvalid=!0)},searchPersonsForLinkPersonSuccess:function(e){this.loginBusy=!0;var t=!1,n=!0,i=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var o=a.value,c=new EcPerson;if(c.copyFrom(o),this.createLinkPersonEmail.equalsIgnoreCase(c.email)){t=!0;break}}}catch(l){i=!0,s=l}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}t?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createPersonObjectToLinkToIdentity()},verifyEmailAddressForLinkPersonAndGo:function(){console.log("Validating link person email...");var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForLinkPersonSuccess,this.searchPersonsForNewAccountFailure)},linkPerson:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateLinkPersonData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForLinkPersonAndGo()},areLoginParamsValid:function(){return null!=this.username&&0!==this.username.length&&null!=this.password&&0!==this.password.length||(this.loginParamsInvalid=!0,!1)},findLinkedPersonPersonSearchSuccess:function(e){console.log("Linked person person search success: "),console.log(e),this.identityToLinkToPerson=EcIdentityManager.ids[0];var t=!1,n=!0,i=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var o=a.value,c=new EcPerson;c.copyFrom(o),c.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(t=!0,this.$store.commit("user/loggedOnPerson",c),this.linkedPerson=c,console.log("Matching person record found: "),console.log(c))}}catch(l){i=!0,s=l}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}t?this.addGroupIdentities():(console.log("Matching person record NOT found"),this.showCreateLinkedPerson())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,console.log("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){console.log("Finding linked person for identity...");var e=EcIdentityManager.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.ids||EcIdentityManager.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginConfigureFromServerSuccess:function(e){console.log("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.username,this.password),this.ecRemoteIdentMgr.fetch(this.handleAttemptLoginFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},attemptCassLogin:function(){this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.areLoginParamsValid()&&(console.log("Attempting CaSS login...."),this.loginBusy=!0,EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail))}},mounted:function(){this.setDataToBaseLogin(!0)}}),r=a,o=(n("364f"),n("2877")),c=Object(o["a"])(r,i,s,!1,null,"b441dc3c",null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-3b36c218.5885b303.js.map