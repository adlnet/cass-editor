(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b2bd5ed"],{"08bc":function(e,t,n){"use strict";var i=n("b3c6"),r=n.n(i);r.a},"25d8":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lode__hierarchy"},[n("div",{staticClass:"hierarchy-buttons columns is-gapless is-paddingless is-mobile is-marginless is-paddingless"},["import"!==e.view?n("div",{staticClass:"column is-narrow",attrs:{id:"check-radio-all-column"}},[n("div",{staticClass:"field"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],staticClass:"is-checkradio",attrs:{id:"selectAllCheckbox",type:"checkbox",name:"selectAllCheckbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:function(t){var n=e.selectAll,i=t.target,r=!!i.checked;if(Array.isArray(n)){var o=null,s=e._i(n,o);i.checked?s<0&&(e.selectAll=n.concat([o])):s>-1&&(e.selectAll=n.slice(0,s).concat(n.slice(s+1)))}else e.selectAll=r}}}),n("label",{attrs:{for:"selectAllCheckbox"}})])]):e._e(),n("div",{staticClass:"column is-narrow"},[e.expanded?n("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!1}}},[n("i",{staticClass:"fa fa-caret-down has-text-primary is-size-2"})]):e.expanded?n("div",{staticClass:"icon is-vcentered"},[n("i",{staticClass:"fa fa-circle is-size-7 has-text-light"})]):n("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!0}}},[n("i",{staticClass:"fa fa-caret-right has-text-primary is-size-2"})]),e.selectButtonText?n("div",{staticClass:"button is-small is-outlined is-primary",on:{click:function(t){return e.$emit("selectButtonClick",e.selectedArray)}}},[e._v("\n                "+e._s(e.selectButtonText)+"\n            ")]):e._e()]),n("div",{staticClass:"column is-narrow"},[n("div",{staticClass:"buttons"},[e.multipleSelected&&!e.addingNode&&"import"!==e.view&&e.canEdit?n("div",{staticClass:"button is-small is-outlined is-primary",on:{click:function(t){return e.$emit("editMultipleEvent")}}},[e._m(0),n("span",[e._v("\n                        Edit multiple\n                    ")])]):e._e(),!e.addingNode&&e.canEdit?n("div",{staticClass:"button is-small is-outlined is-primary",on:{click:function(t){e.addingNode=!0}}},[e._m(1),n("span",[e._v("\n                        Add Concept\n                    ")])]):e._e(),e.addingNode?n("div",{staticClass:"button is-outlined is-small is-dark ",on:{click:function(t){e.addingNode=!1}}},[e._m(2),n("span",[e._v("cancel")])]):e._e(),e.addingNode?n("div",{staticClass:"button is-outlined is-small is-primary ",on:{click:function(t){e.add(e.container.shortId(),null),e.addingNode=!1}}},[e._m(3),n("span",[e._v("\n                        create new\n                    ")])]):e._e()])])]),n("hr"),e.hierarchy?[n("draggable",e._b({staticClass:"lode__hierarchy-ul",attrs:{tag:"ul",disabled:!0!==e.canEdit||!e.isDraggable,group:{name:"test"},handle:".handle"},on:{start:e.beginDrag,end:e.endDrag},model:{value:e.hierarchy,callback:function(t){e.hierarchy=t},expression:"hierarchy"}},"draggable",e.dragOptions,!1),e._l(e.hierarchy,(function(t,i){return n("HierarchyNode",{key:t.obj.id,staticClass:"lode__hierarchy-li",attrs:{view:e.view,subview:e.subview,obj:t.obj,dragging:e.dragging,canEdit:e.canEdit,hasChild:t.children,profile:e.profile,exportOptions:e.exportOptions,highlightList:e.highlightList,selectAll:e.selectAll,newFramework:e.newFramework,index:i,frameworkEditable:e.canEdit,parentStructure:e.hierarchy,parent:e.container,properties:e.properties,expandAll:1==e.expanded,parentChecked:!1},on:{createNewNodeEvent:e.onCreateNewNode,mountingNode:e.handleMountingNode,add:e.add,beginDrag:e.beginDrag,move:e.move,deleteObject:e.deleteObject,exportObject:e.exportObject,select:e.select,draggableCheck:e.onDraggableCheck}})})),1)]:e._e()],2)},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"icon"},[n("i",{staticClass:"fa fa-cog"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"icon"},[n("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"icon"},[n("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"icon"},[n("i",{staticClass:"fa fa-plus"})])}],s=n("872c"),a={name:"ConceptHierarchy",props:{container:Object,containerType:String,repo:Object,profile:Object,exportOptions:Array,highlightList:Array,selectMode:Boolean,selectAll:Boolean,containerTypeGet:String,viewOnly:Boolean,newFramework:Boolean,properties:String,view:{type:String,default:"framework"},subview:{type:String,default:""}},data:function(){return{structure:[],once:!0,dragging:!1,controlOnStart:!1,filter:"showAll",dragIcon:"fa-arrows-alt",dragOptions:{delay:100,disabled:!1,ghostClass:"ghost-drag",chosenClass:"chosen-drag",dragClass:"drag",scrollSensitivity:200,forceFallback:!0},multipleSelected:!1,addingNode:!1,selectedArray:[],selectButtonText:null,expanded:!0,isDraggable:!0}},components:{HierarchyNode:function(){return n.e("chunk-278dbbb4").then(n.bind(null,"8461"))},draggable:function(){return n.e("chunk-b27dd9ce").then(n.t.bind(null,"310e",7))}},mixins:[s["a"]],computed:{queryParams:function(){return this.$store.getters["editor/queryParams"]},hierarchy:function(){var e=this;if(null==this.container)return null;if(!this.once)return this.structure;console.log("Computing hierarchy.");var t=[];return null!=this.container["skos:hasTopConcept"]&&(t=t.concat(this.container["skos:hasTopConcept"])),t.length>0?this.repo.multiget(t,(function(t){e.computeHierarchy()}),console.error,console.log):e.computeHierarchy(),this.structure},canEdit:function(){return!0!==this.viewOnly&&this.container.canEditAny(EcIdentityManager.getMyPks())},recomputeHierarchy:function(){return this.$store.getters["editor/recomputeHierarchy"]}},watch:{container:{handler:function(){this.once=!0},deep:!0},selectedArray:function(){this.selectedArray.length>1?this.multipleSelected=!0:this.multipleSelected=!1,this.$emit("selectedArray",this.selectedArray)},recomputeHierarchy:function(){this.recomputeHierarchy&&(this.once=!0,this.$store.commit("editor/recomputeHierarchy",!1))}},mounted:function(){this.queryParams&&(this.queryParams.singleSelect&&(this.selectButtonText=this.queryParams.singleSelect),this.queryParams.select&&""!==this.queryParams.select&&"select"!==this.queryParams.select&&(this.selectButtonText=this.queryParams.select))},methods:{onCreateNewNode:function(e,t){this.add(e,t)},handleMountingNode:function(){this.startTime()},startTime:function(){var e=this;setTimeout((function(){e.$emit("doneLoadingNodes")}),1e3)},computeHierarchy:function(){if(this.structure.splice(0,this.structure.length),null==this.container)return r;if(null!==this.container["skos:hasTopConcept"]&&void 0!==this.container["skos:hasTopConcept"])for(var e=0;e<this.container["skos:hasTopConcept"].length;e++){var t=EcConcept.getBlocking(this.container["skos:hasTopConcept"][e]);t&&(this.structure.push({obj:t,children:[]}),t["skos:narrower"]&&this.addChildren(this.structure,t,e))}this.once=!1},addChildren:function(e,t,n){for(var i=0;i<t["skos:narrower"].length;i++){var r=EcConcept.getBlocking(t["skos:narrower"][i]);e[n].children.push({obj:r,children:[]}),r&&r["skos:narrower"]&&this.addChildren(e[n].children,r,i)}},beginDrag:function(){this.dragging=!0,void 0!==event&&(this.controlOnStart=event.originalEvent.ctrlKey||event.originalEvent.shiftKey)},endDrag:function(e){console.log(e.oldIndex,e.newIndex);var t=null,n=0;e.from.id===e.to.id?(e.newIndex<this.hierarchy.length&&(t=this.hierarchy[e.newIndex].obj.shortId()),n=1):void 0===e.to.children[e.newIndex]?t=e.to.id:e.newIndex+1<e.to.children.length&&(t=e.to.children[e.newIndex+1].id),this.move(this.hierarchy[e.oldIndex].obj.shortId(),t,e.from.id,e.to.id,!this.controlOnStart,n)},move:function(e,t,n,i,r,o){this.once=!0;var s=this;if(n===i){var a=EcConcept.getBlocking(i),c="skos:narrower";null===a&&(a=this.container,c="skos:hasTopConcept");var l=a[c]?a[c].slice():null,d=a[c].indexOf(e);if(a[c].splice(d,1),null==t||void 0===t)EcArray.isArray(a[c])||(a[c]=[]),a[c].push(e);else{var h=a[c].indexOf(t);a[c].splice(h,0,e)}s.$store.commit("editor/addEditsToUndo",[{operation:"update",id:a.shortId(),fieldChanged:[c],initialValue:[l]}]),a["schema:dateModified"]=(new Date).toISOString(),!0===this.$store.state.editor.private&&!0!==EcEncryptedValue.encryptOnSaveMap[a.id]&&(a=EcEncryptedValue.toEncryptedValue(a)),this.repo.saveTo(a,(function(){s.computeHierarchy()}),console.error)}else{var u=EcConcept.getBlocking(e),p=EcConcept.getBlocking(n),g="skos:narrower",f="skos:broader",m=EcConcept.getBlocking(i),y="skos:narrower",v="skos:broader";null===p&&(p=this.container,g="skos:hasTopConcept",f="skos:topConceptOf"),null===m&&(m=this.container,y="skos:hasTopConcept",v="skos:topConceptOf");d=p[g].indexOf(e);var E=p[g].slice(),k=u[f]?u[f].slice():null,C=m[y]?m[y].slice():null,w=u[v]?u[v].slice():null;p[g].splice(d,1),n&&u[f]?(EcArray.setRemove(u[f],n),0===u[f].length&&delete u[f]):delete u[f],p["schema:dateModified"]=(new Date).toISOString(),!0===this.$store.state.editor.private&&!0!==EcEncryptedValue.encryptOnSaveMap[p.id]&&(p=EcEncryptedValue.toEncryptedValue(p)),this.repo.saveTo(p,(function(){if(null==t||void 0===t)EcArray.isArray(m[y])||(m[y]=[]),m[y].push(e);else{var n=m[y].indexOf(t);m[y].splice(n,0,e)}EcArray.isArray(u[v])||(u[v]=[]),i?u[v].push(i):u[v].push(s.container.shortId()),s.$store.commit("editor/addEditsToUndo",[{operation:"update",id:p.shortId(),fieldChanged:[g],initialValue:[E]},{operation:"update",id:m.shortId(),fieldChanged:[y],initialValue:[C]},{operation:"update",id:u.shortId(),fieldChanged:[f,v],initialValue:[k,w]}]),m["schema:dateModified"]=(new Date).toISOString(),u["schema:dateModified"]=(new Date).toISOString(),!0===s.$store.state.editor.private&&!0!==EcEncryptedValue.encryptOnSaveMap[m.id]&&(m=EcEncryptedValue.toEncryptedValue(m)),!0===s.$store.state.editor.private&&!0!==EcEncryptedValue.encryptOnSaveMap[u.id]&&(u=EcEncryptedValue.toEncryptedValue(u)),s.repo.saveTo(m,(function(){s.repo.saveTo(u,console.log,console.error),s.computeHierarchy()}),console.log)}),console.error)}this.dragging=!1},add:function(e,t){var n=this,i=new EcConcept;if(this.queryParams.newObjectEndpoint?i.generateShortId(this.queryParams.newObjectEndpoint):i.generateId(this.repo.selectedServer),i["schema:dateCreated"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),null!=EcIdentityManager.ids&&EcIdentityManager.ids.length>0&&i.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.container.owner&&this.container.owner.length>0)for(var r=0;r<this.container.owner.length;r++){var o=this.container.owner[r];i.addOwner(EcPk.fromPem(o))}if(this.$store.state.editor&&this.$store.state.editor.configuration){var s=this.$store.state.editor.configuration;if(s["defaultObjectOwners"])for(var a=0;a<s["defaultObjectOwners"].length;a++)i.addOwner(EcPk.fromPem(s["defaultObjectOwners"][a]));if(s["defaultObjectReaders"])for(a=0;a<s["defaultObjectReaders"].length;a++)i.addReader(EcPk.fromPem(s["defaultObjectReaders"][a]))}if(this.setDefaultLanguage(),i["skos:prefLabel"]={"@language":this.$store.state.editor.defaultLanguage,"@value":"New Concept"},i["skos:inScheme"]=this.container.shortId(),e===this.container.shortId()){var c=this.container["skos:hasTopConcept"]?this.container["skos:hasTopConcept"].slice():null;if(EcArray.isArray(this.container["skos:hasTopConcept"])||(this.container["skos:hasTopConcept"]=[]),null==t||void 0===t)this.container["skos:hasTopConcept"].unshift(i.shortId());else{var l=this.container["skos:hasTopConcept"].indexOf(t);this.container["skos:hasTopConcept"].splice(l+1,0,i.shortId())}i["skos:topConceptOf"]=this.container.shortId(),n.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:i.shortId()},{operation:"update",id:this.container.shortId(),fieldChanged:["skos:hasTopConcept"],initialValue:[c]}]),this.container["schema:dateModified"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),!0===this.$store.state.editor.private&&(i=EcEncryptedValue.toEncryptedValue(i),!0!==EcEncryptedValue.encryptOnSaveMap[n.container.id]&&(n.container=EcEncryptedValue.toEncryptedValue(n.container))),this.repo.saveTo(i,(function(){n.repo.saveTo(n.container,(function(){n.once=!0}),console.error)}),console.error)}else{i["skos:broader"]=[e];var d=EcConcept.getBlocking(e);c=d["skos:narrower"]?d["skos:narrower"].slice():null;if(EcArray.isArray(d["skos:narrower"])||(d["skos:narrower"]=[]),null==t||void 0===t)d["skos:narrower"].unshift(i.shortId());else{l=d["skos:narrower"].indexOf(t);d["skos:narrower"].splice(l+1,0,i.shortId())}n.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:i.shortId()},{operation:"update",id:d.shortId(),fieldChanged:["skos:narrower"],initialValue:[c]}]),this.container["schema:dateModified"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),d["schema:dateModified"]=(new Date).toISOString(),!0===this.$store.state.editor.private&&(i=EcEncryptedValue.toEncryptedValue(i),!0!==EcEncryptedValue.encryptOnSaveMap[d.id]&&(d=EcEncryptedValue.toEncryptedValue(d)),!0!==EcEncryptedValue.encryptOnSaveMap[n.container.id]&&(n.container=EcEncryptedValue.toEncryptedValue(n.container))),this.repo.saveTo(i,(function(){n.repo.saveTo(d,(function(){n.repo.saveTo(n.container,(function(){n.once=!0}),console.error)}),console.error)}),console.error)}this.$store.commit("editor/newCompetency",i.shortId()),console.log("Added node: ",JSON.parse(i.toJson()))},select:function(e,t){t?EcArray.setAdd(this.selectedArray,e):EcArray.setRemove(this.selectedArray,e)},deleteObject:function(e){this.$emit("deleteObject",e)},exportObject:function(e,t){this.$emit("exportObject",e,t)},onDraggableCheck:function(e){this.isDraggable=e}}},c=a,l=(n("08bc"),n("2877")),d=Object(l["a"])(c,i,o,!1,null,null,null);t["default"]=d.exports},b3c6:function(e,t,n){}}]);
//# sourceMappingURL=chunk-2b2bd5ed.7595c79f.js.map